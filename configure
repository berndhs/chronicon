#!/bin/bash

# configure script for
#
#  chronicon  twitter client
#
# Copyright (C) 2010 Bernd Stramm
#

usage () {
   echo 
   echo "$0 [OPTIONS]"
   echo
   echo "Options:"
   echo "--help            Show this help message and quit"
   echo "--prefix=PREFIX   Install into PREFIX [${PREFIX}]"
   echo "--nonotify        do not use libnotify [default]"
   echo "--yesnotify       use libnotify "
   echo "--build buildarg  is ignored"
   echo
}

COPYRIGHT=" Copyright (C) 2010 Bernd Stramm"
PREFIX=/usr
USE_NOTIFY=no
OPTIONS_FILE=chronicon/options.pri
# see if they said anything about prefix
while test $# != 0
do
  case $1 in
  --*=*)
  ac_option=`expr "X$1" : 'X\([^=]*\)='`
  ac_optarg=`expr "X$1" : 'X[^=]*=\(.*\)'`
  ac_shift=:
  ;;
 *)
  ac_option=$1
  ac_optarg=$2
  ac_shift=shift
  ;;
  esac

case $ac_option in
  --help)
   usage
   exit 0
   ;;
  --prefix)
   PREFIX=$ac_optarg
   $ac_shift
   ;;
  --nonotify)
   USE_NOTIFY=no
   ;;
  --yesnotify)
   USE_NOTIFY=yes
   ;;
  *)
   echo "Bad option " $ac_option " " $ac_optarg
   usage
   shift
   ;;
  esac
shift

done 

QM=`sh ./findqmake.sh`
if [ ! $? -eq 0 ] ; then
  echo 
  echo "Error: Cannot find qmake"
  echo
  echo "       Check Qt installation? "
  echo
  exit 1
fi
OSLEN=`expr match "Z$OS" "ZWindow"`
if [ $OSLEN -gt 5 ] ; then
  QM="qmake.exe"
  MAKE_PROGRAM="mingw32-make.exe"
else
  MAKE_PROGRAM="make"
fi


if [ ${USE_NOTIFY} == "no" ] ; then
  echo "DEFINES += USE_NOTIFY=0" > ${OPTIONS_FILE}
else
  echo "DEFINES += USE_NOTIFY=1" > ${OPTIONS_FILE}
  echo "CONFIG += link_pkgconfig" >> ${OPTIONS_FILE}
  echo "PKGCONFIG += libnotify" >> ${OPTIONS_FILE}
fi

echo "#" > Makefile
echo "# Makefile generated by configure" >> Makefile
echo "# Faux automake" >> Makefile
echo "# ${COPYRIGHT}" >> Makefile
echo "#" >> Makefile
echo "PREFIX=${PREFIX}" >> Makefile
echo "DESTDIR=\${PREFIX}/bin" >> Makefile
echo "QMAKE = $QM" >> Makefile
echo "MAKE = ${MAKE_PROGRAM}" >> Makefile
cat Makefile.in >> Makefile
echo ""
echo "qmake is                  " $QM
echo "Installation prefix is    " $PREFIX
echo "Now you can build with    " $MAKE_PROGRAM

